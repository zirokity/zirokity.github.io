<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì° Propagacja dla Polski</title>
    <script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(30, 30, 50, 0.9);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 2px solid #4cc9f0;
        }
        h1 {
            color: #4cc9f0;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(76, 201, 240, 0.5);
        }
        .subtitle {
            color: #aaa;
            font-size: 1.1em;
        }
        .day-night {
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.8em;
            font-weight: bold;
            text-align: center;
            animation: pulse 2s infinite;
        }
        .day-night.day {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #000;
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.5);
        }
        .day-night.night {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: #fff;
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
        }
        .day-night.dawn {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            color: #fff;
            box-shadow: 0 0 30px rgba(249, 115, 22, 0.5);
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        .clock-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .clock-box {
            background: rgba(40, 40, 70, 0.8);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #4cc9f0;
            text-align: center;
        }
        .clock-time {
            font-size: 2.5em;
            font-weight: bold;
            color: #4cc9f0;
            margin-bottom: 10px;
        }
        .clock-date {
            font-size: 1.1em;
            color: #aaa;
            margin-bottom: 5px;
        }
        .clock-label {
            font-size: 0.9em;
            color: #777;
            margin-top: 5px;
        }
        .sun-info {
            background: rgba(50, 50, 80, 0.8);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #fbbf24;
            text-align: center;
        }
        .sun-title {
            font-size: 1.3em;
            color: #fbbf24;
            margin-bottom: 15px;
            font-weight: bold;
        }
        .sun-times {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
        }
        .sun-item {
            text-align: center;
        }
        .sun-icon {
            font-size: 2.5em;
            margin-bottom: 5px;
        }
        .sun-label {
            font-size: 0.9em;
            color: #aaa;
            display: block;
            margin-top: 5px;
        }
        .sun-time {
            font-size: 1.5em;
            font-weight: bold;
            color: #fbbf24;
        }
        .status {
            display: flex;
            justify-content: space-between;
            background: rgba(40, 40, 70, 0.8);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #4cc9f0;
        }
        .status-item {
            text-align: center;
            flex: 1;
        }
        .status-label {
            font-size: 0.9em;
            color: #aaa;
            margin-bottom: 8px;
        }
        .status-value {
            font-size: 2em;
            font-weight: bold;
        }
        .sfi-good { color: #4ade80; }
        .sfi-medium { color: #fbbf24; }
        .sfi-bad { color: #f87171; }
        .kindex-good { color: #4ade80; }
        .kindex-medium { color: #fbbf24; }
        .kindex-bad { color: #f87171; }
        .bands {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 30px;
            margin-bottom: 20px;
        }
        .band {
            background: rgba(50, 50, 80, 0.8);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .band:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        .band-label {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .band-status {
            font-size: 1.1em;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 5px;
        }
        .band-good { 
            background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
            color: #fff;
            border-color: #22c55e;
        }
        .band-medium { 
            background: linear-gradient(135deg, #ca8a04 0%, #b45309 100%);
            color: #fff;
            border-color: #f59e0b;
        }
        .band-bad { 
            background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%);
            color: #fff;
            border-color: #ef4444;
        }
        .refresh-btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #4cc9f0 0%, #4361ee 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .refresh-btn:hover {
            background: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
            transform: scale(1.02);
        }
        .info {
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(70, 70, 100, 0.3);
            border-radius: 10px;
            font-size: 0.95em;
            line-height: 1.6;
        }
        .info h3 {
            color: #4cc9f0;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        .info ul {
            margin-left: 25px;
            margin-top: 10px;
        }
        .info li {
            margin-bottom: 8px;
        }
        .sources {
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(80, 40, 120, 0.3);
            border-radius: 10px;
            border-left: 4px solid #8b5cf6;
        }
        .sources h3 {
            color: #8b5cf6;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3em;
        }
        .sources h3::before {
            content: "üì°";
        }
        .sources p {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        .sources a {
            color: #4cc9f0;
            text-decoration: none;
            font-weight: bold;
        }
        .sources a:hover {
            text-decoration: underline;
        }
        .sources ul {
            margin-left: 25px;
            margin-top: 10px;
        }
        .sources li {
            margin-bottom: 8px;
        }
        .data-source {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #555;
            font-size: 0.9em;
            font-weight: bold;
        }
        .data-source.live { color: #4ade80; }
        .data-source.mock { color: #fbbf24; }
        .timestamp {
            text-align: center;
            color: #777;
            font-size: 0.9em;
            padding: 15px;
        }
        
        /* Toast notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }
        .toast {
            background: rgba(30, 30, 50, 0.95);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            border-left: 4px solid #4cc9f0;
            animation: slideIn 0.3s ease-out, fadeOut 0.5s ease-in 4.5s;
            min-width: 300px;
        }
        .toast.good {
            border-left-color: #4ade80;
            background: rgba(22, 163, 74, 0.9);
        }
        .toast.bad {
            border-left-color: #f87171;
            background: rgba(185, 28, 28, 0.9);
        }
        .toast.warning {
            border-left-color: #fbbf24;
            background: rgba(202, 138, 4, 0.9);
        }
        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; transform: translateX(100px); }
        }
        
        @media (max-width: 768px) {
            .clock-container {
                grid-template-columns: 1fr;
            }
            .sun-times {
                flex-direction: column;
                gap: 15px;
            }
            h1 {
                font-size: 2em;
            }
            .toast {
                min-width: auto;
                width: 90%;
            }
        }
    </style>
</head>
<body>
    <!-- Toast container dla alert√≥w -->
    <div class="toast-container" id="toast-container"></div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üì° Propagacja dla Polski</h1>
            <div class="subtitle">Czy dzi≈õ fale siƒô niosƒÖ?</div>
            
            <!-- Dzie≈Ñ/Noc - DU≈ªY WY≈öWIETLACZ -->
            <div class="day-night" id="day-night-status">
                ≈Åadowanie...
            </div>
        </div>

        <!-- Zegary i wsch√≥d/zach√≥d -->
        <div class="clock-container">
            <!-- Czas Polski -->
            <div class="clock-box">
                <div class="clock-time" id="polish-time">--:--:--</div>
                <div class="clock-date" id="polish-date">--.--.----</div>
                <div class="clock-label">Czas Polski (CET/CEST)</div>
            </div>
            
            <!-- Czas UTC -->
            <div class="clock-box">
                <div class="clock-time" id="utc-time">--:--:--</div>
                <div class="clock-date" id="utc-date">--.--.----</div>
                <div class="clock-label">Universal Time Coordinated</div>
            </div>
        </div>

        <!-- Wsch√≥d/Zach√≥d S≈Ço≈Ñca -->
        <div class="sun-info">
            <div class="sun-title">üåÖ Wsch√≥d i zach√≥d S≈Ço≈Ñca (Warszawa)</div>
            <div class="sun-times">
                <div class="sun-item">
                    <div class="sun-icon">üåÖ</div>
                    <div class="sun-time" id="sunrise">--:--</div>
                    <span class="sun-label">Wsch√≥d</span>
                </div>
                <div class="sun-item">
                    <div class="sun-icon">‚òÄÔ∏è</div>
                    <div class="sun-time" id="solar-noon">--:--</div>
                    <span class="sun-label">Po≈Çudnie</span>
                </div>
                <div class="sun-item">
                    <div class="sun-icon">üåá</div>
                    <div class="sun-time" id="sunset">--:--</div>
                    <span class="sun-label">Zach√≥d</span>
                </div>
            </div>
        </div>

        <!-- Status - SFI, K-index, A-index -->
        <div class="status">
            <div class="status-item">
                <div class="status-label">SFI</div>
                <div class="status-value sfi-good" id="sfi">?</div>
            </div>
            <div class="status-item">
                <div class="status-label">K-index</div>
                <div class="status-value kindex-good" id="kindex">?</div>
            </div>
            <div class="status-item">
                <div class="status-label">A-index</div>
                <div class="status-value" id="aindex">?</div>
            </div>
        </div>

        <!-- Pasma -->
        <div class="bands" id="bands">
            <div class="band">
                <div class="band-label">160m</div>
                <div class="band-status band-medium" id="band-160m">≈öREDNIO</div>
            </div>
            <div class="band">
                <div class="band-label">80m</div>
                <div class="band-status band-good" id="band-80m">DOBRZE</div>
            </div>
            <div class="band">
                <div class="band-label">40m</div>
                <div class="band-status band-good" id="band-40m">DOBRZE</div>
            </div>
            <div class="band">
                <div class="band-label">30m</div>
                <div class="band-status band-good" id="band-30m">DOBRZE</div>
            </div>
            <div class="band">
                <div class="band-label">20m</div>
                <div class="band-status band-good" id="band-20m">DOBRZE</div>
            </div>
            <div class="band">
                <div class="band-label">17m</div>
                <div class="band-status band-medium" id="band-17m">≈öREDNIO</div>
            </div>
            <div class="band">
                <div class="band-label">15m</div>
                <div class="band-status band-medium" id="band-15m">≈öREDNIO</div>
            </div>
            <div class="band">
                <div class="band-label">12m</div>
                <div class="band-status band-bad" id="band-12m">≈πLE</div>
            </div>
            <div class="band">
                <div class="band-label">10m</div>
                <div class="band-status band-bad" id="band-10m">≈πLE</div>
            </div>
        </div>

        <button class="refresh-btn" onclick="refreshData()">üîÑ Od≈õwie≈º dane</button>

        <div class="info">
            <h3>üìä Jak to interpretowaƒá?</h3>
            <ul>
                <li><span style="color: #4ade80;">üü¢ DOBRZE</span> ‚Äì Pasmo otwarte, gra na DX</li>
                <li><span style="color: #fbbf24;">üü° ≈öREDNIO</span> ‚Äì Lokalnie dzia≈Ça, DX trudniejszy</li>
                <li><span style="color: #f87171;">üî¥ ≈πLE</span> ‚Äì Pasmo zamkniƒôte, lepiej poczekaƒá</li>
            </ul>
            <p style="margin-top: 15px; font-weight: bold;">
                <strong>üåû DZIE≈É</strong> ‚Äì 20m, 17m, 15m otwarte na ≈õwiatowe DX<br>
                <strong>üåô NOC</strong> ‚Äì 80m, 160m dla dalekich dystans√≥w<br>
                <strong>üåÖ ZMIERZCH</strong> ‚Äì 40m otwiera siƒô na Amerykƒô P≈Çd./Azjƒô
            </p>
        </div>

        <div class="sources">
            <h3>≈πr√≥d≈Ça danych</h3>
            <p>Dane pochodzƒÖ z:</p>
            <ul>
                <li><a href="https://www.hamqsl.com/solar.html" target="_blank">hamqsl.com</a> ‚Äì dane s≈Çoneczne (przez proxy CORS)</li>
                <li><a href="https://prop.kc2g.com" target="_blank">prop.kc2g.com</a> ‚Äì wizualizacja propagacji</li>
            </ul>
            
            <div class="data-source" id="data-source-info">
                ≈Åadowanie danych...
            </div>
        </div>

        <div class="timestamp" id="timestamp"></div>
    </div>

    <script>
        // Zmienne do ≈õledzenia zmian propagacji
        let prevKIndex = null;
        let prevSFI = null;
        let lastToastTime = 0;

        // Zegar - aktualizacja co sekundƒô
        function updateClock() {
            const now = new Date();
            
            // Czas polski (automatycznie uwzglƒôdnia DST)
            const polishTime = now.toLocaleTimeString('pl-PL', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                timeZone: 'Europe/Warsaw'
            });
            const polishDate = now.toLocaleDateString('pl-PL', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                timeZone: 'Europe/Warsaw'
            });
            
            // Czas UTC
            const utcTime = now.toISOString().substring(11, 19);
            const utcDate = now.toISOString().substring(0, 10);
            
            // Aktualizuj elementy
            document.getElementById('polish-time').textContent = polishTime;
            document.getElementById('polish-date').textContent = polishDate;
            document.getElementById('utc-time').textContent = utcTime;
            document.getElementById('utc-date').textContent = utcDate;
            
            // Sprawd≈∫ czy jest dzie≈Ñ czy noc
            updateDayNightStatus();
        }

        // Oblicz wsch√≥d/zach√≥d S≈Ço≈Ñca dla Polski (Warszawa)
        function calculateSunTimes() {
            const now = new Date();
            const lat = 52.2297;  // Warszawa
            const lon = 21.0122;
            
            const times = SunCalc.getTimes(now, lat, lon);
            
            // Formatuj czas
            const formatTime = (date) => {
                return date.toLocaleTimeString('pl-PL', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            };
            
            document.getElementById('sunrise').textContent = formatTime(times.sunrise);
            document.getElementById('sunset').textContent = formatTime(times.sunset);
            
            // Oblicz po≈Çudnie s≈Çoneczne (≈õrodek miƒôdzy wschodem a zachodem)
            const solarNoon = new Date((times.sunrise.getTime() + times.sunset.getTime()) / 2);
            document.getElementById('solar-noon').textContent = formatTime(solarNoon);
            
            return times;
        }

        // Aktualizuj status Dzie≈Ñ/Noc
        function updateDayNightStatus() {
            const now = new Date();
            const lat = 52.2297;
            const lon = 21.0122;
            
            const times = SunCalc.getTimes(now, lat, lon);
            
            const dayNightEl = document.getElementById('day-night-status');
            
            // Sprawd≈∫ czy jest noc (przed wschodem lub po zachodzie)
            const isNight = now < times.sunrise || now > times.sunset;
            
            // Sprawd≈∫ czy jest ≈õwit/≈õwitanie (30 min przed/po wschodzie)
            const dawnStart = new Date(times.sunrise.getTime() - 30 * 60000);
            const dawnEnd = new Date(times.sunrise.getTime() + 30 * 60000);
            const isDawn = now >= dawnStart && now <= dawnEnd;
            
            // Sprawd≈∫ czy jest zmierzch (30 min przed/po zachodzie)
            const duskStart = new Date(times.sunset.getTime() - 30 * 60000);
            const duskEnd = new Date(times.sunset.getTime() + 30 * 60000);
            const isDusk = now >= duskStart && now <= duskEnd;
            
            if (isNight) {
                dayNightEl.textContent = "üåô NOC";
                dayNightEl.className = "day-night night";
            } else if (isDawn || isDusk) {
                dayNightEl.textContent = isDawn ? "üåÖ ≈öWIT" : "üåá ZMIERZCH";
                dayNightEl.className = "day-night dawn";
            } else {
                dayNightEl.textContent = "‚òÄÔ∏è DZIE≈É";
                dayNightEl.className = "day-night day";
            }
        }

        // Poka≈º toast notification
        function showToast(message, type = 'info') {
            const now = Date.now();
            // Limit: max 1 toast na 10 sekund (≈ºeby nie spamowaƒá)
            if (now - lastToastTime < 10000) {
                return;
            }
            lastToastTime = now;
            
            const toastContainer = document.getElementById('toast-container');
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <strong>${type === 'good' ? 'üéâ' : type === 'bad' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}</strong> ${message}
            `;
            
            toastContainer.appendChild(toast);
            
            // Usu≈Ñ toast po 5 sekundach
            setTimeout(() => {
                toast.style.animation = 'fadeOut 0.5s ease-in';
                setTimeout(() => {
                    toast.remove();
                }, 500);
            }, 5000);
        }

        // Sprawd≈∫ zmiany propagacji
        function checkPropagationChanges(currentKIndex, currentSFI) {
            // Sprawd≈∫ K-index
            if (prevKIndex !== null && currentKIndex !== prevKIndex) {
                if (currentKIndex <= 2 && prevKIndex > 2) {
                    showToast('K-index spad≈Ç do ' + currentKIndex + '! Propagacja siƒô poprawi≈Ça! üéâ', 'good');
                } else if (currentKIndex >= 5 && prevKIndex < 5) {
                    showToast('K-index wzr√≥s≈Ç do ' + currentKIndex + '! Propagacja siƒô pogorszy≈Ça! ‚ö†Ô∏è', 'bad');
                } else if (currentKIndex > prevKIndex) {
                    showToast('K-index wzr√≥s≈Ç z ' + prevKIndex + ' do ' + currentKIndex, 'warning');
                } else if (currentKIndex < prevKIndex) {
                    showToast('K-index spad≈Ç z ' + prevKIndex + ' do ' + currentKIndex, 'good');
                }
            }
            
            // Sprawd≈∫ SFI
            if (prevSFI !== null && currentSFI !== prevSFI) {
                const diff = currentSFI - prevSFI;
                if (Math.abs(diff) >= 10) { // ZnaczƒÖca zmiana
                    if (diff > 0) {
                        showToast('SFI wzr√≥s≈Ç o ' + diff + '!', 'good');
                    } else {
                        showToast('SFI spad≈Ç o ' + Math.abs(diff) + '!', 'warning');
                    }
                }
            }
            
            // Zapisz bie≈ºƒÖce warto≈õci
            prevKIndex = currentKIndex;
            prevSFI = currentSFI;
        }

        // Funkcja do pobierania danych przez proxy CORS
        async function fetchRealData() {
            try {
                // U≈ºywamy corsproxy.io ≈ºeby ominƒÖƒá blokadƒô CORS
                const proxyUrl = 'https://corsproxy.io/?';
                const targetUrl = 'https://www.hamqsl.com/solarxml.php';
                const response = await fetch(proxyUrl + encodeURIComponent(targetUrl));
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const xmlText = await response.text();
                
                // Parsuj XML
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, "text/xml");
                
                // Sprawd≈∫ czy XML siƒô poprawnie sparsowa≈Ç
                if (xmlDoc.querySelector('parsererror')) {
                    throw new Error('B≈ÇƒÖd parsowania XML');
                }
                
                // Pobierz dane
                const solarfluxEl = xmlDoc.querySelector('solarflux');
                const kindexEl = xmlDoc.querySelector('kindex');
                const aindexEl = xmlDoc.querySelector('aindex');
                
                if (!solarfluxEl || !kindexEl || !aindexEl) {
                    throw new Error('Brak wymaganych element√≥w w XML');
                }
                
                const sfi = parseInt(solarfluxEl.textContent || '0');
                const kindex = parseInt(kindexEl.textContent || '0');
                const aindex = parseInt(aindexEl.textContent || '0');
                const timestamp = new Date().toLocaleString('pl-PL');
                
                // Walidacja danych
                if (sfi < 50 || sfi > 300 || isNaN(sfi)) {
                    throw new Error('Nieprawid≈Çowy SFI');
                }
                if (kindex < 0 || kindex > 9 || isNaN(kindex)) {
                    throw new Error('Nieprawid≈Çowy K-index');
                }
                
                return {
                    sfi: sfi,
                    kindex: kindex,
                    aindex: aindex,
                    timestamp: timestamp,
                    source: 'live'
                };
                
            } catch (error) {
                console.error('B≈ÇƒÖd pobierania danych:', error);
                return null; // Zwr√≥ƒá null je≈õli nie uda≈Ço siƒô pobraƒá
            }
        }

        // Mock dane jako fallback
        function getMockData() {
            // Generuj realistyczne mock dane na podstawie pory dnia
            const now = new Date();
            const hour = now.getUTCHours();
            
            // Wieczorem K-index zwykle ni≈ºszy, SFI stabilny
            let sfi = 130 + Math.floor(Math.random() * 30) - 15;
            let kindex = hour >= 20 || hour < 8 ? 1 + Math.floor(Math.random() * 2) : 2 + Math.floor(Math.random() * 3);
            
            return {
                sfi: sfi,
                kindex: kindex,
                aindex: Math.round(kindex * 8),
                timestamp: new Date().toLocaleString('pl-PL'),
                source: 'mock'
            };
        }

        // Funkcja oceny pasma na podstawie K-index i SFI
        function evaluateBand(band, kindex, sfi) {
            if (kindex <= 2 && sfi > 120) {
                if (band === '10m' || band === '12m' || band === '15m' || band === '17m' || band === '20m') {
                    return { status: 'DOBRZE', color: 'good' };
                } else {
                    return { status: 'DOBRZE', color: 'good' };
                }
            } else if (kindex <= 3 && sfi > 100) {
                if (band === '10m' || band === '12m') {
                    return { status: '≈öREDNIO', color: 'medium' };
                } else if (band === '15m' || band === '17m') {
                    return { status: 'DOBRZE', color: 'good' };
                } else {
                    return { status: 'DOBRZE', color: 'good' };
                }
            } else if (kindex <= 4) {
                if (band === '10m' || band === '12m' || band === '15m') {
                    return { status: '≈πLE', color: 'bad' };
                } else if (band === '17m' || band === '20m') {
                    return { status: '≈öREDNIO', color: 'medium' };
                } else {
                    return { status: 'DOBRZE', color: 'good' };
                }
            } else {
                if (band === '10m' || band === '12m' || band === '15m' || band === '17m' || band === '20m') {
                    return { status: '≈πLE', color: 'bad' };
                } else if (band === '30m' || band === '40m') {
                    return { status: '≈öREDNIO', color: 'medium' };
                } else {
                    return { status: 'DOBRZE', color: 'good' };
                }
            }
        }

        // Funkcja od≈õwie≈ºania danych
        async function refreshData() {
            const refreshBtn = document.querySelector('.refresh-btn');
            refreshBtn.textContent = 'üîÑ ≈Åadowanie...';
            refreshBtn.disabled = true;

            try {
                // Najpierw spr√≥buj pobraƒá prawdziwe dane przez proxy
                let data = await fetchRealData();
                
                // Je≈õli nie uda≈Ço siƒô, u≈ºyj mock danych
                if (!data) {
                    data = getMockData();
                    document.getElementById('data-source-info').textContent = '‚ö†Ô∏è Dane symulowane (brak po≈ÇƒÖczenia)';
                    document.getElementById('data-source-info').className = 'data-source mock';
                } else {
                    document.getElementById('data-source-info').textContent = '‚úÖ Dane na ≈ºywo z hamqsl.com';
                    document.getElementById('data-source-info').className = 'data-source live';
                }
                
                // Sprawd≈∫ zmiany propagacji
                checkPropagationChanges(data.kindex, data.sfi);
                
                // Aktualizuj wy≈õwietlane dane
                document.getElementById('sfi').textContent = data.sfi;
                document.getElementById('kindex').textContent = data.kindex;
                document.getElementById('aindex').textContent = data.aindex;
                document.getElementById('timestamp').textContent = `Ostatnia aktualizacja: ${data.timestamp}`;
                
                // Ustaw kolory dla SFI i K-index
                const sfiEl = document.getElementById('sfi');
                const kindexEl = document.getElementById('kindex');
                
                // SFI colors
                if (data.sfi > 150) {
                    sfiEl.className = 'status-value sfi-good';
                } else if (data.sfi > 100) {
                    sfiEl.className = 'status-value sfi-medium';
                } else {
                    sfiEl.className = 'status-value sfi-bad';
                }
                
                // K-index colors
                if (data.kindex <= 2) {
                    kindexEl.className = 'status-value kindex-good';
                } else if (data.kindex <= 4) {
                    kindexEl.className = 'status-value kindex-medium';
                } else {
                    kindexEl.className = 'status-value kindex-bad';
                }
                
                // Ocena pasm
                const bands = ['160m', '80m', '40m', '30m', '20m', '17m', '15m', '12m', '10m'];
                
                bands.forEach(band => {
                    const result = evaluateBand(band, data.kindex, data.sfi);
                    const el = document.getElementById(`band-${band}`);
                    el.textContent = result.status;
                    el.className = `band-status band-${result.color}`;
                });
                
            } catch (error) {
                console.error('B≈ÇƒÖd:', error);
                alert('Nie uda≈Ço siƒô pobraƒá danych. Sprawd≈∫ po≈ÇƒÖczenie internetowe.');
            } finally {
                refreshBtn.textContent = 'üîÑ Od≈õwie≈º dane';
                refreshBtn.disabled = false;
            }
        }

        // Auto-refresh co 5 minut
        setInterval(refreshData, 300000);

        // Oblicz wsch√≥d/zach√≥d przy starcie i od≈õwie≈ºaj co godzinƒô
        calculateSunTimes();
        setInterval(calculateSunTimes, 3600000);

        // Za≈Çaduj dane przy starcie
        window.onload = function() {
            updateClock();
            setInterval(updateClock, 1000);
            refreshData();
        };
    </script>
</body>
</html>
