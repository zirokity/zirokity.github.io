<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì° Propagacja PL</title>
    <script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'JetBrains Mono', monospace;
            background: #0d0d0d;
            color: #ddd;
            padding: 15px;
            line-height: 1.5;
        }
        .container {
            max-width: 650px;
            margin: 0 auto;
        }
        header {
            text-align: center;
            margin-bottom: 15px;
        }
        h1 {
            font-size: 1.6em;
            color: #5eead4;
            letter-spacing: -0.5px;
            margin-bottom: 8px;
        }
        .subtitle {
            color: #777;
            font-size: 0.9em;
        }
        
        /* DU≈ªY WY≈öWIETLACZ DZIE≈É/NOC */
        .day-night-display {
            text-align: center;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            font-size: 1.8em;
            font-weight: bold;
            letter-spacing: 2px;
        }
        .day-night-display.day {
            background: linear-gradient(135deg, #4a2109 0%, #854d0e 100%);
            color: #fef3c7;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.3);
        }
        .day-night-display.night {
            background: linear-gradient(135deg, #0e2a47 0%, #1e40af 100%);
            color: #93c5fd;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }
        .day-night-display.dawn {
            background: linear-gradient(135deg, #431407 0%, #92400e 100%);
            color: #ffedd5;
            box-shadow: 0 0 20px rgba(249, 115, 22, 0.3);
        }
        
        /* Dane SFI/K-index */
        .data-header {
            display: flex;
            justify-content: space-between;
            background: #151515;
            padding: 12px 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        .data-item {
            text-align: center;
            flex: 1;
            padding: 0 5px;
        }
        .data-label {
            font-size: 0.85em;
            color: #777;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 4px;
        }
        .data-value {
            font-size: 1.8em;
            font-weight: bold;
        }
        .sfi-good { color: #34d399; }
        .sfi-medium { color: #fbbf24; }
        .sfi-bad { color: #f87171; }
        .k-good { color: #34d399; }
        .k-medium { color: #fbbf24; }
        .k-bad { color: #f87171; }
        
        /* Tabela pasm */
        .table-container {
            background: #151515;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 25px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th {
            background: #1a1a1a;
            padding: 12px 10px;
            text-align: left;
            font-weight: bold;
            color: #5eead4;
            border-bottom: 1px solid #333;
        }
        td {
            padding: 10px 10px;
            border-bottom: 1px solid #2a2a2a;
        }
        tr:hover {
            background: #202020;
        }
        .band-name {
            font-weight: bold;
            color: #5eead4;
            width: 100px;
        }
        .day-condition, .night-condition {
            font-weight: bold;
            text-align: center;
        }
        .condition-poor { color: #f87171; }
        .condition-fair { color: #fbbf24; }
        .condition-good { color: #34d399; }
        
        /* Zegary */
        .clocks {
            display: flex;
            justify-content: space-between;
            background: #151515;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-size: 0.95em;
        }
        .clock {
            text-align: center;
            flex: 1;
        }
        .clock-time {
            font-size: 1.5em;
            font-weight: bold;
            color: #5eead4;
            margin-bottom: 4px;
        }
        .clock-label {
            color: #777;
            font-size: 0.85em;
        }
        
        .refresh-btn {
            width: 100%;
            padding: 10px;
            background: #1a1a1a;
            color: #5eead4;
            border: 1px solid #333;
            border-radius: 5px;
            font-family: inherit;
            font-size: 1.05em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        .refresh-btn:hover {
            background: #202020;
            border-color: #5eead4;
        }
        
        /* ≈πr√≥d≈Ça danych */
        .sources {
            background: #151515;
            padding: 15px;
            border-radius: 6px;
            margin-top: 25px;
            font-size: 0.85em;
        }
        .sources h3 {
            color: #8b5cf6;
            margin-bottom: 10px;
            font-size: 1em;
        }
        .sources p {
            margin-bottom: 8px;
            color: #aaa;
        }
        .sources a {
            color: #5eead4;
            text-decoration: none;
        }
        .sources a:hover {
            text-decoration: underline;
        }
        .data-source {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #2a2a2a;
            color: #777;
        }
        .data-source.live { color: #34d399; font-weight: bold; }
        .data-source.mock { color: #fbbf24; font-weight: bold; }
        
        .timestamp {
            text-align: center;
            color: #666;
            font-size: 0.8em;
            margin-top: 15px;
            padding-top: 12px;
            border-top: 1px solid #2a2a2a;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üì° Propagacja PL</h1>
            <div class="subtitle">Dane z hamqsl.com</div>
        </header>

        <!-- DU≈ªY WY≈öWIETLACZ DZIE≈É/NOC -->
        <div class="day-night-display" id="day-night-display">
            ≈Åadowanie...
        </div>

        <!-- Dane SFI/K-index -->
        <div class="data-header">
            <div class="data-item">
                <div class="data-label">SFI</div>
                <div class="data-value sfi-good" id="sfi">?</div>
            </div>
            <div class="data-item">
                <div class="data-label">K-index</div>
                <div class="data-value k-good" id="kindex">?</div>
            </div>
        </div>

        <!-- Tabela pasm -->
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Band</th>
                        <th>Day</th>
                        <th>Night</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="band-name">80m-40m</td>
                        <td class="day-condition condition-poor" id="band-80m-40m-day">Poor</td>
                        <td class="night-condition condition-good" id="band-80m-40m-night">Good</td>
                    </tr>
                    <tr>
                        <td class="band-name">30m-20m</td>
                        <td class="day-condition condition-good" id="band-30m-20m-day">Good</td>
                        <td class="night-condition condition-good" id="band-30m-20m-night">Good</td>
                    </tr>
                    <tr>
                        <td class="band-name">17m-15m</td>
                        <td class="day-condition condition-good" id="band-17m-15m-day">Good</td>
                        <td class="night-condition condition-fair" id="band-17m-15m-night">Fair</td>
                    </tr>
                    <tr>
                        <td class="band-name">12m-10m</td>
                        <td class="day-condition condition-good" id="band-12m-10m-day">Good</td>
                        <td class="night-condition condition-poor" id="band-12m-10m-night">Poor</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Zegary -->
        <div class="clocks">
            <div class="clock">
                <div class="clock-time" id="polish-time">--:--:--</div>
                <div class="clock-label">Czas Polski</div>
            </div>
            <div class="clock">
                <div class="clock-time" id="utc-time">--:--:--</div>
                <div class="clock-label">UTC</div>
            </div>
        </div>

        <button class="refresh-btn" onclick="refreshData()">Od≈õwie≈º dane</button>

        <!-- ≈πr√≥d≈Ça danych -->
        <div class="sources">
            <h3>üì° ≈πr√≥d≈Ça danych</h3>
            <p><strong>SFI (Solar Flux Index)</strong> ‚Äì pomiar z obserwatorium w <strong>Penticton, Kanada</strong>.</p>
            <p><strong>K-index</strong> ‚Äì aktywno≈õƒá geomagnetyczna Ziemi z <strong>NOAA SWPC</strong>.</p>
            <p><strong>Warunki pasm</strong> ‚Äì obliczane lokalnie na podstawie SFI i K-index zgodnie z modelem propagacyjnym.</p>
            <p><strong>Dane na ≈ºywo:</strong> <a href="https://www.hamqsl.com/solar.html" target="_blank">hamqsl.com/solar.html</a></p>
            
            <div class="data-source" id="data-source-info">
                ≈Åadowanie danych...
            </div>
        </div>

        <div class="timestamp" id="timestamp">≈Åadowanie...</div>
    </div>

    <script>
        // Zegar - aktualizacja co sekundƒô
        function updateClock() {
            const now = new Date();
            const plTime = now.toLocaleTimeString('pl-PL', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                timeZone: 'Europe/Warsaw'
            });
            const utcTime = now.toISOString().substring(11, 19);
            
            document.getElementById('polish-time').textContent = plTime;
            document.getElementById('utc-time').textContent = utcTime;
            updateDayNightDisplay();
        }

        // Aktualizuj wy≈õwietlacz dnia/nocy
        function updateDayNightDisplay() {
            const now = new Date();
            const times = SunCalc.getTimes(now, 52.2297, 21.0122);
            const display = document.getElementById('day-night-display');
            
            const isNight = now < times.sunrise || now > times.sunset;
            const dawnStart = new Date(times.sunrise.getTime() - 20*60000);
            const dawnEnd = new Date(times.sunrise.getTime() + 20*60000);
            const duskStart = new Date(times.sunset.getTime() - 20*60000);
            const duskEnd = new Date(times.sunset.getTime() + 20*60000);
            const isDawn = now >= dawnStart && now <= dawnEnd;
            const isDusk = now >= duskStart && now <= duskEnd;
            
            if (isNight) {
                display.textContent = "üåô NOC";
                display.className = "day-night-display night";
            } else if (isDawn || isDusk) {
                display.textContent = isDawn ? "üåÖ ≈öWIT" : "üåá ZMIERZCH";
                display.className = "day-night-display dawn";
            } else {
                display.textContent = "‚òÄÔ∏è DZIE≈É";
                display.className = "day-night-display day";
            }
        }

        // Pobierz dane z hamqsl.com przez proxy
        async function fetchData() {
            try {
                const proxyUrl = 'https://corsproxy.io/?';
                const targetUrl = 'https://www.hamqsl.com/solarxml.php';
                const response = await fetch(proxyUrl + encodeURIComponent(targetUrl), { mode: 'cors' });
                
                if (!response.ok) {
                    throw new Error('B≈ÇƒÖd odpowiedzi');
                }
                
                const xmlText = await response.text();
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, "text/xml");
                
                if (xmlDoc.querySelector('parsererror')) {
                    throw new Error('B≈ÇƒÖd parsowania XML');
                }
                
                const sfiEl = xmlDoc.querySelector('solarflux');
                const kindexEl = xmlDoc.querySelector('kindex');
                
                if (!sfiEl || !kindexEl) {
                    throw new Error('Brak danych w XML');
                }
                
                const sfi = parseInt(sfiEl.textContent || '0');
                const kindex = parseInt(kindexEl.textContent || '0');
                
                if (isNaN(sfi) || isNaN(kindex)) {
                    throw new Error('Nieprawid≈Çowe dane');
                }
                
                return {
                    sfi: sfi,
                    kindex: kindex,
                    timestamp: new Date().toLocaleString('pl-PL'),
                    source: 'live'
                };
                
            } catch (error) {
                console.warn('B≈ÇƒÖd pobierania danych:', error);
                // Fallback na mock dane
                const now = new Date();
                const hour = now.getUTCHours();
                const mockK = hour >= 20 || hour < 8 ? 1 + Math.floor(Math.random() * 2) : 2 + Math.floor(Math.random() * 3);
                const mockSFI = 130 + Math.floor(Math.random() * 25) - 12;
                
                return {
                    sfi: mockSFI,
                    kindex: mockK,
                    timestamp: new Date().toLocaleString('pl-PL'),
                    source: 'mock'
                };
            }
        }

        // Oblicz warunki pasm na podstawie SFI i K-index
        function calculateBandConditions(sfi, kindex) {
            // 80m-40m: zawsze Poor w dzie≈Ñ (D-layer absorbuje), Good w nocy
            document.getElementById('band-80m-40m-day').textContent = "Poor";
            document.getElementById('band-80m-40m-day').className = "day-condition condition-poor";
            document.getElementById('band-80m-40m-night').textContent = kindex <= 3 ? "Good" : "Fair";
            document.getElementById('band-80m-40m-night').className = "night-condition " + (kindex <= 3 ? "condition-good" : "condition-fair");
            
            // 30m-20m: Good w dzie≈Ñ i nocy przy dobrym K-index
            document.getElementById('band-30m-20m-day').textContent = kindex <= 3 ? "Good" : "Fair";
            document.getElementById('band-30m-20m-day').className = "day-condition " + (kindex <= 3 ? "condition-good" : "condition-fair");
            document.getElementById('band-30m-20m-night').textContent = kindex <= 3 ? "Good" : "Fair";
            document.getElementById('band-30m-20m-night').className = "night-condition " + (kindex <= 3 ? "condition-good" : "condition-fair");
            
            // 17m-15m: Good w dzie≈Ñ przy dobrym SFI, Fair w nocy
            document.getElementById('band-17m-15m-day').textContent = sfi > 120 && kindex <= 3 ? "Good" : "Fair";
            document.getElementById('band-17m-15m-day').className = "day-condition " + (sfi > 120 && kindex <= 3 ? "condition-good" : "condition-fair");
            document.getElementById('band-17m-15m-night').textContent = kindex <= 2 ? "Good" : "Fair";
            document.getElementById('band-17m-15m-night').className = "night-condition " + (kindex <= 2 ? "condition-good" : "condition-fair");
            
            // 12m-10m: Good w dzie≈Ñ tylko przy wysokim SFI, Poor w nocy
            document.getElementById('band-12m-10m-day').textContent = sfi > 140 && kindex <= 2 ? "Good" : (sfi > 110 && kindex <= 3 ? "Fair" : "Poor");
            document.getElementById('band-12m-10m-day').className = "day-condition " + 
                (sfi > 140 && kindex <= 2 ? "condition-good" : (sfi > 110 && kindex <= 3 ? "condition-fair" : "condition-poor"));
            document.getElementById('band-12m-10m-night').textContent = kindex <= 2 ? "Fair" : "Poor";
            document.getElementById('band-12m-10m-night').className = "night-condition " + (kindex <= 2 ? "condition-fair" : "condition-poor");
        }

        // Od≈õwie≈º dane
        async function refreshData() {
            const btn = document.querySelector('.refresh-btn');
            btn.disabled = true;
            btn.textContent = '≈Åadowanie...';
            
            try {
                const data = await fetchData();
                
                // Aktualizuj SFI/K-index
                document.getElementById('sfi').textContent = data.sfi;
                document.getElementById('kindex').textContent = data.kindex;
                document.getElementById('timestamp').textContent = `Ostatnia aktualizacja: ${data.timestamp}`;
                
                // Ustaw kolory
                const sfiEl = document.getElementById('sfi');
                const kEl = document.getElementById('kindex');
                
                sfiEl.className = `data-value ${data.sfi > 150 ? 'sfi-good' : data.sfi > 100 ? 'sfi-medium' : 'sfi-bad'}`;
                kEl.className = `data-value ${data.kindex <= 2 ? 'k-good' : data.kindex <= 4 ? 'k-medium' : 'k-bad'}`;
                
                // Oblicz warunki pasm
                calculateBandConditions(data.sfi, data.kindex);
                
                // Status ≈∫r√≥d≈Ça
                const sourceInfo = document.getElementById('data-source-info');
                sourceInfo.textContent = data.source === 'live' 
                    ? '‚úÖ Dane na ≈ºywo z hamqsl.com' 
                    : '‚ö†Ô∏è Dane symulowane (offline)';
                sourceInfo.className = `data-source ${data.source === 'live' ? 'live' : 'mock'}`;
                
            } catch (error) {
                console.error('B≈ÇƒÖd:', error);
                alert('Nie uda≈Ço siƒô pobraƒá danych. Sprawd≈∫ po≈ÇƒÖczenie internetowe.');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Od≈õwie≈º dane';
            }
        }

        // Init
        updateClock();
        setInterval(updateClock, 1000);
        refreshData();
        setInterval(refreshData, 300000);
    </script>
</body>
</html>
